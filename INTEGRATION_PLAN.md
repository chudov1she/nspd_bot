# –ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ –†–æ—Å—Ä–µ–µ—Å—Ç—Ä–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å

## üìã –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á–∏

### –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á–∏ (worker.py)

1. **–ü–∞—Ä—Å–∏–Ω–≥ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã—Ö –Ω–æ–º–µ—Ä–æ–≤** (`_parse_cadastral_numbers`)
   - –ò–∑ —Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ —Ñ–∞–π–ª–∞
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ API** (`_check_api_for_task`)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è API –∫–ª—é—á–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞

3. **–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ API** (`_fetch_api_data`)
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–º–µ—Ä–∞: `api_client.get_cadastral_data(number)`
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã: `List[RealEstateObject]`
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–º–µ—Ä–∞

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** (`_process_results`)
   - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞—Ä—Ç –¥–ª—è –∑–µ–º–µ–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç
   - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Excel –æ—Ç—á—ë—Ç–∞
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (RealEstateObject)

–ü–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç—å:
- `owner: Optional[str]` - –ü—Ä–∞–≤–æ–æ–±–ª–∞–¥–∞—Ç–µ–ª—å (—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫)
- `encumbrances: Optional[str]` - –û–±—Ä–µ–º–µ–Ω–µ–Ω–∏—è (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)

–≠—Ç–∏ –ø–æ–ª—è —É–∂–µ –µ—Å—Ç—å –≤ –º–æ–¥–µ–ª–∏ –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ Excel –æ—Ç—á—ë—Ç–µ.

### –ü–∞—Ç—Ç–µ—Ä–Ω singleton –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤

**MapGenerator** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω singleton:
- `get_map_generator()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
- –û–¥–∏–Ω –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –≤—Å–µ—Ö –∑–∞–¥–∞—á –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞—Ä—Ç
- –ë—Ä–∞—É–∑–µ—Ä –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏

---

## üéØ –ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –¢–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á–∏ (–¥–µ—Ç–∞–ª—å–Ω–æ)

```
_process_task(task)
  ‚îú‚îÄ _parse_cadastral_numbers(task) ‚Üí List[str]
  ‚îú‚îÄ _check_api_for_task(task, numbers) ‚Üí bool
  ‚îú‚îÄ _fetch_api_data(numbers, task_id) ‚Üí List[RealEstateObject]
  ‚îÇ   ‚îî‚îÄ –î–ª—è –∫–∞–∂–¥–æ–≥–æ number:
  ‚îÇ       ‚îî‚îÄ api_client.get_cadastral_data(number) ‚Üí RealEstateObject
  ‚îÇ           ‚îî‚îÄ –ó–∞–ø–æ–ª–Ω—è–µ—Ç: cadastral_number, object_type, address, area, 
  ‚îÇ                         category, permitted_use, cadastral_value, 
  ‚îÇ                         rights, owner, encumbrances, status, –∏ —Ç.–¥.
  ‚îÇ           ‚îî‚îÄ owner –∏ encumbrances –º–æ–≥—É—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏
  ‚îÇ
  ‚îî‚îÄ _process_results(task, numbers, results)
      ‚îú‚îÄ _create_map_tasks_for_land_plots(task, results)
      ‚îú‚îÄ _process_map_generation_tasks(results)
      ‚îú‚îÄ create_output_excel(results) ‚Üí Path
      ‚îî‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

### –ù–æ–≤—ã–π –ø–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á–∏ (—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –õ–ö)

```
_process_task(task)
  ‚îú‚îÄ _parse_cadastral_numbers(task) ‚Üí List[str]
  ‚îú‚îÄ _check_api_for_task(task, numbers) ‚Üí bool
  ‚îú‚îÄ _fetch_api_data(numbers, task_id) ‚Üí List[RealEstateObject]
  ‚îÇ   ‚îî‚îÄ [–°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –ö–û–î - –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π]
  ‚îÇ
  ‚îú‚îÄ _enrich_data_from_lk(results, task_id) ‚Üí List[RealEstateObject]  [–ù–û–í–û–ï]
  ‚îÇ   ‚îî‚îÄ –î–ª—è –∫–∞–∂–¥–æ–≥–æ obj –≤ results:
  ‚îÇ       ‚îî‚îÄ –ï—Å–ª–∏ obj –±–µ–∑ –æ—à–∏–±–∫–∏ –ò (owner –ø—É—Å—Ç–æ–π –ò–õ–ò encumbrances –ø—É—Å—Ç–æ–π):
  ‚îÇ           ‚îú‚îÄ –ü–æ–ª—É—á–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä lk_client
  ‚îÇ           ‚îú‚îÄ –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –õ–ö (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –æ—Ç–∫—Ä—ã—Ç–∞)
  ‚îÇ           ‚îú‚îÄ –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ —Ñ–æ—Ä–º–µ
  ‚îÇ           ‚îú‚îÄ –ü–æ–ª—É—á–∏—Ç—å –∏ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∫–∞–ø—á—É
  ‚îÇ           ‚îú‚îÄ –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä
  ‚îÇ           ‚îú‚îÄ –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∫–∞–ø—á—É
  ‚îÇ           ‚îú‚îÄ –ö–ª–∏–∫–Ω—É—Ç—å "–ù–ê–ô–¢–ò"
  ‚îÇ           ‚îú‚îÄ –î–æ–∂–¥–∞—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  ‚îÇ           ‚îú‚îÄ –ö–ª–∏–∫–Ω—É—Ç—å –ø–æ –ø–µ—Ä–≤–æ–π —Å—Å—ã–ª–∫–µ
  ‚îÇ           ‚îú‚îÄ –î–æ–∂–¥–∞—Ç—å—Å—è –∫–∞—Ä—Ç–æ—á–∫–∏ –æ–±—ä–µ–∫—Ç–∞
  ‚îÇ           ‚îú‚îÄ –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–∞–≤–∞—Ö –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö
  ‚îÇ           ‚îú‚îÄ –û–±–Ω–æ–≤–∏—Ç—å obj.owner –∏ obj.encumbrances
  ‚îÇ           ‚îî‚îÄ –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞
  ‚îÇ
  ‚îî‚îÄ _process_results(task, numbers, results)
      ‚îú‚îÄ _create_map_tasks_for_land_plots(task, results)
      ‚îú‚îÄ _process_map_generation_tasks(results)
      ‚îú‚îÄ create_output_excel(results) ‚Üí Path
      ‚îÇ   ‚îî‚îÄ Excel —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ owner –∏ encumbrances
      ‚îî‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

---

## üéØ –ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 1. –°–æ–∑–¥–∞–Ω–∏–µ singleton –¥–ª—è RosreestrLKClient

**–§–∞–π–ª:** `bot/services/rosreestr_lk/__init__.py`

–î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å `map_generator`:
```python
_lk_client: RosreestrLKClient | None = None

def get_lk_client() -> RosreestrLKClient:
    """–ü–æ–ª—É—á–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∏–µ–Ω—Ç–∞ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞."""
    global _lk_client
    if _lk_client is None:
        _lk_client = RosreestrLKClient(use_llm_for_captcha=...)
    return _lk_client

async def close_lk_client():
    """–ó–∞–∫—Ä—ã—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞."""
    global _lk_client
    if _lk_client:
        await _lk_client.close()
        _lk_client = None
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

**–ù–æ–≤—ã–π —Ñ–∞–π–ª:** `bot/services/rosreestr_lk/data_enricher.py`

–ö–ª–∞—Å—Å `LKDataEnricher`:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä `RosreestrLKClient`
- –ú–µ—Ç–æ–¥ `enrich_object_data(obj: RealEstateObject) -> RealEstateObject`
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–∞–≤–∞—Ö –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö
- –ó–∞–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª—è `owner` –∏ `encumbrances`

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ worker.py

**–ú–µ—Å—Ç–æ –≤—Å—Ç–∞–≤–∫–∏:** –ü–æ—Å–ª–µ `_fetch_api_data`, –ø–µ—Ä–µ–¥ `_create_map_tasks_for_land_plots`

**–ù–æ–≤—ã–π –º–µ—Ç–æ–¥:** `_enrich_data_from_lk(results: List[RealEstateObject], task_id: int) -> List[RealEstateObject]`

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä `RosreestrLKClient`
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –≤ `results`:
   - –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –±–µ–∑ –æ—à–∏–±–∫–∏ (`not obj.has_error()`)
   - –ò –µ—Å–ª–∏ `owner` –∏–ª–∏ `encumbrances` –ø—É—Å—Ç—ã–µ (–∏–ª–∏ –æ–±–∞)
   - –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –õ–ö:
     - –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –õ–ö (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –æ—Ç–∫—Ä—ã—Ç–∞)
     - –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ —Ñ–æ—Ä–º–µ
     - –ü–æ–ª—É—á–∏—Ç—å –∏ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∫–∞–ø—á—É
     - –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä
     - –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∫–∞–ø—á—É
     - –ö–ª–∏–∫–Ω—É—Ç—å "–ù–ê–ô–¢–ò"
     - –î–æ–∂–¥–∞—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
     - –ö–ª–∏–∫–Ω—É—Ç—å –ø–æ –ø–µ—Ä–≤–æ–π —Å—Å—ã–ª–∫–µ
     - –î–æ–∂–¥–∞—Ç—å—Å—è –∫–∞—Ä—Ç–æ—á–∫–∏ –æ–±—ä–µ–∫—Ç–∞
     - –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–∞–≤–∞—Ö –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö
     - –û–±–Ω–æ–≤–∏—Ç—å `obj.owner` –∏ `obj.encumbrances`
     - –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞ (–∏–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É)
3. –í–µ—Ä–Ω—É—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É –≤–∫–ª–∞–¥–∫—É –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞ (–∏–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ (–Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—Ç—å –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å)

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–í `_process_results` (worker.py, —Å—Ç—Ä–æ–∫–∞ ~465):**

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
async def _process_results(self, task: Task, numbers: List[str], results: List[RealEstateObject]):
    # –°–æ–∑–¥–∞–µ–º –∑–∞–¥–∞—á–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞—Ä—Ç –≤ –ë–î –¥–ª—è –∑–µ–º–µ–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤
    await self._create_map_tasks_for_land_plots(task, results)
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–¥–∞—á–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞—Ä—Ç
    await self._process_map_generation_tasks(results)
    
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
```

**–ù–æ–≤—ã–π –∫–æ–¥:**
```python
async def _process_results(self, task: Task, numbers: List[str], results: List[RealEstateObject]):
    # –ù–û–í–û–ï: –î–æ–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ –†–æ—Å—Ä–µ–µ—Å—Ç—Ä–∞
    results = await self._enrich_data_from_lk(results, task.id)
    
    # –°–æ–∑–¥–∞–µ–º –∑–∞–¥–∞—á–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞—Ä—Ç –≤ –ë–î –¥–ª—è –∑–µ–º–µ–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤
    await self._create_map_tasks_for_land_plots(task, results)
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–¥–∞—á–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞—Ä—Ç
    await self._process_map_generation_tasks(results)
    
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
```

```python
async def _process_results(self, task: Task, numbers: List[str], results: List[RealEstateObject]):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    # 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ API (—É–∂–µ –µ—Å—Ç—å)
    # results = await self._fetch_api_data(numbers, task.id)
    
    # 2. –ù–û–í–û–ï: –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
    results = await self._enrich_data_from_lk(results, task.id)
    
    # 3. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞—Ä—Ç (—É–∂–µ –µ—Å—Ç—å)
    await self._create_map_tasks_for_land_plots(task, results)
    
    # 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç (—É–∂–µ –µ—Å—Ç—å)
    # ...
    
    # 5. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Excel –æ—Ç—á—ë—Ç–∞ (—É–∂–µ –µ—Å—Ç—å)
    # ...
```

### 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- –ï—Å–ª–∏ –õ–ö –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ API –¥–∞–Ω–Ω—ã–µ
- –ï—Å–ª–∏ –∫–∞–ø—á–∞ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞ - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ–±—ä–µ–∫—Ç, –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–µ –ø–æ–ª—è
- –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –õ–ö - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ API –¥–∞–Ω–Ω—ã–µ
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å

### 6. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–æ–º

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ë—Ä–∞—É–∑–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –∑–∞–¥–∞—á–µ
- –ó–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ (–∏–ª–∏ –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏)

**–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏:**
- –í–∞—Ä–∏–∞–Ω—Ç 1: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
- –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ)
- –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞, –Ω–æ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç 1 (–≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞) - –ø—Ä–æ—â–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ.

### 7. –ú–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞

**–í `bot/services/rosreestr_lk/core.py`:**

```python
async def navigate_to_search_page(self) -> bool:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞.
    
    Returns:
        True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ, False –∏–Ω–∞—á–µ
    """
    try:
        # –ü—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–Ω–æ–≤–æ (–æ–Ω–∞ —É–∂–µ –≤ –∏—Å—Ç–æ—Ä–∏–∏)
        await self._page.goto(self.LK_URL, wait_until="domcontentloaded", timeout=30000)
        await self._page.wait_for_load_state("networkidle", timeout=10000)
        await self.scroll_to_form()
        return True
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞: {e}")
        return False
```

---

## üîÑ –î–µ—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –º–µ—Ç–æ–¥–∞ `_enrich_data_from_lk`

```python
async def _enrich_data_from_lk(
    self,
    results: List[RealEstateObject],
    task_id: int
) -> List[RealEstateObject]:
    """
    –î–æ–ø–æ–ª–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç–æ–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ –†–æ—Å—Ä–µ–µ—Å—Ç—Ä–∞.
    
    Args:
        results: –°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ API
        task_id: ID –∑–∞–¥–∞—á–∏ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    
    Returns:
        –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤
    """
    from bot.services.rosreestr_lk import get_lk_client
    
    # –ü–æ–ª—É—á–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∏–µ–Ω—Ç–∞
    lk_client = get_lk_client()
    
    # –§–∏–ª—å—Ç—Ä—É–µ–º –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç—å
    objects_to_enrich = [
        obj for obj in results
        if not obj.has_error() and (not obj.owner or not obj.encumbrances)
    ]
    
    if not objects_to_enrich:
        logger.info(f"[–ó–∞–¥–∞—á–∞ {task_id}] –ù–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∏–∑ –õ–ö")
        return results
    
    logger.info(f"[–ó–∞–¥–∞—á–∞ {task_id}] –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –õ–ö –¥–ª—è {len(objects_to_enrich)} –æ–±—ä–µ–∫—Ç–æ–≤")
    
    try:
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±—Ä–∞—É–∑–µ—Ä –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if lk_client._browser is None:
            await lk_client.open_lk_page()
            await lk_client.scroll_to_form()
        
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç
        for idx, obj in enumerate(objects_to_enrich, 1):
            try:
                logger.info(f"[–ó–∞–¥–∞—á–∞ {task_id}] –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ {idx}/{len(objects_to_enrich)}: {obj.cadastral_number}")
                
                # –ü–æ–ª—É—á–∞–µ–º –∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ–º –∫–∞–ø—á—É
                captcha_path, captcha_text = await lk_client.get_and_recognize_captcha()
                
                if not captcha_text:
                    logger.warning(f"[–ó–∞–¥–∞—á–∞ {task_id}] –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∫–∞–ø—á—É –¥–ª—è {obj.cadastral_number}")
                    continue
                
                # –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è
                await lk_client.fill_captcha(captcha_text)
                await lk_client.fill_cadastral_number(obj.cadastral_number)
                
                # –ö–ª–∏–∫–∞–µ–º –ø–æ–∏—Å–∫
                await lk_client.click_search_button()
                
                # –ñ–¥–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                if not await lk_client.wait_for_search_results():
                    logger.warning(f"[–ó–∞–¥–∞—á–∞ {task_id}] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è {obj.cadastral_number}")
                    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞
                    await lk_client.open_lk_page()
                    await lk_client.scroll_to_form()
                    continue
                
                # –ö–ª–∏–∫–∞–µ–º –ø–æ –ø–µ—Ä–≤–æ–π —Å—Å—ã–ª–∫–µ
                if not await lk_client.click_first_result():
                    logger.warning(f"[–ó–∞–¥–∞—á–∞ {task_id}] –°—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –¥–ª—è {obj.cadastral_number}")
                    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞
                    await lk_client.open_lk_page()
                    await lk_client.scroll_to_form()
                    continue
                
                # –ñ–¥–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
                if not await lk_client.wait_for_object_card():
                    logger.warning(f"[–ó–∞–¥–∞—á–∞ {task_id}] –ö–∞—Ä—Ç–æ—á–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å –¥–ª—è {obj.cadastral_number}")
                    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞
                    await lk_client.open_lk_page()
                    await lk_client.scroll_to_form()
                    continue
                
                # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                rights_data = await lk_client.extract_rights_and_restrictions()
                
                if rights_data:
                    # –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è
                    owner, encumbrances = _parse_rights_data(rights_data)
                    if owner:
                        obj.owner = owner
                    if encumbrances:
                        obj.encumbrances = encumbrances
                    
                    logger.info(f"[–ó–∞–¥–∞—á–∞ {task_id}] –î–∞–Ω–Ω—ã–µ –¥–æ–ø–æ–ª–Ω–µ–Ω—ã –¥–ª—è {obj.cadastral_number}")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞
                await lk_client.navigate_to_search_page()
                
            except Exception as e:
                logger.error(f"[–ó–∞–¥–∞—á–∞ {task_id}] –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ {obj.cadastral_number}: {e}")
                # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å–æ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—ä–µ–∫—Ç–æ–º
                try:
                    await lk_client.navigate_to_search_page()
                except:
                    pass
                continue
        
        logger.info(f"[–ó–∞–¥–∞—á–∞ {task_id}] –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –õ–ö –∑–∞–≤–µ—Ä—à–µ–Ω–æ")
        
    except Exception as e:
        logger.error(f"[–ó–∞–¥–∞—á–∞ {task_id}] –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ –∏–∑ –õ–ö: {e}")
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–∑ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
    
    return results

def _parse_rights_data(rights_data: list[dict]) -> tuple[Optional[str], Optional[str]]:
    """
    –ü–∞—Ä—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–∞–≤–∞—Ö –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö.
    
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
    - "–í–∏–¥, –Ω–æ–º–µ—Ä –∏ –¥–∞—Ç–∞ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–∞–≤–∞" ‚Üí owner (–≤–∏–¥ –ø—Ä–∞–≤–∞)
    - "–û–±—Ä–µ–º–µ–Ω–µ–Ω–∏—è" ‚Üí encumbrances
    
    Returns:
        –ö–æ—Ä—Ç–µ–∂ (–ø—Ä–∞–≤–æ–æ–±–ª–∞–¥–∞—Ç–µ–ª—å, –æ–±—Ä–µ–º–µ–Ω–µ–Ω–∏—è)
    """
    owner = None
    encumbrances = None
    
    for item in rights_data:
        name = item.get('name', '').lower()
        values = item.get('values', [])
        
        if not values:
            continue
        
        # –ò—â–µ–º –ø—Ä–∞–≤–æ–æ–±–ª–∞–¥–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ "–í–∏–¥, –Ω–æ–º–µ—Ä –∏ –¥–∞—Ç–∞ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–∞–≤–∞"
        # –û–±—ã—á–Ω–æ —Ç–∞–º: "–°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "‚Ññ ...", "–æ—Ç ..."
        if '–≤–∏–¥' in name and ('—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è' in name or '–ø—Ä–∞–≤–æ' in name):
            # –ü–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—ã—á–Ω–æ –≤–∏–¥ –ø—Ä–∞–≤–∞ (–°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –ê—Ä–µ–Ω–¥–∞ –∏ —Ç.–¥.)
            # –û—Å—Ç–∞–ª—å–Ω—ã–µ - –Ω–æ–º–µ—Ä –∏ –¥–∞—Ç–∞
            owner_parts = []
            for val in values:
                val_lower = val.lower()
                # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–æ–º–µ—Ä–∞ –∏ –¥–∞—Ç—ã, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥ –ø—Ä–∞–≤–∞
                if '‚Ññ' not in val and '–æ—Ç' not in val_lower and not val_lower.startswith('–æ—Ç'):
                    owner_parts.append(val)
            if owner_parts:
                owner = '; '.join(owner_parts)
        
        # –ò—â–µ–º –æ–±—Ä–µ–º–µ–Ω–µ–Ω–∏—è
        if '–æ–±—Ä–µ–º–µ–Ω–µ–Ω–∏–µ' in name or '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ' in name:
            encumbrances = '; '.join(values)
    
    return owner, encumbrances
```

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–∞—Ö

### 1. `bot/services/rosreestr_lk/__init__.py`
- –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ `get_lk_client()` –∏ `close_lk_client()`

### 2. `bot/services/rosreestr_lk/core.py`
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `navigate_to_search_page()` –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞

### 3. `bot/services/rosreestr_lk/core.py`
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `navigate_to_search_page()` –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞

### 4. `bot/services/worker.py`
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_enrich_data_from_lk()` –ø–æ—Å–ª–µ `_fetch_api_data`
- –î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ –≤ `_process_results()` (–ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è API –¥–∞–Ω–Ω—ã—Ö, –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–∞—Ä—Ç)
- –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `_parse_rights_data()` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–∞–≤–∞—Ö

### 5. `bot/services/__init__.py`
- –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç `get_lk_client`, `close_lk_client`

### 6. `run.py`
- –î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫—Ä—ã—Ç–∏–µ –õ–ö –∫–ª–∏–µ–Ω—Ç–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –±–æ—Ç–∞ (–≤ –±–ª–æ–∫–µ `finally`)

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –ü—Ä–æ—Ü–µ—Å—Å –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–¥–ª–µ–Ω–Ω—ã–π (–∫–∞–ø—á–∞, –ø–æ–∏—Å–∫, –∫–ª–∏–∫–∏)
   - –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫—É
   - –ú–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã —Å –ø—É—Å—Ç—ã–º–∏ –ø–æ–ª—è–º–∏

2. **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å:**
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
   - –ù–µ –ø—Ä–µ—Ä—ã–≤–∞—Ç—å –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏

3. **–†–µ—Å—É—Ä—Å—ã:**
   - –û–¥–∏–Ω –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –≤—Å–µ—Ö –∑–∞–¥–∞—á (singleton)
   - –ë—Ä–∞—É–∑–µ—Ä –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏
   - –ó–∞–∫—Ä—ã—Ç–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –±–æ—Ç–∞

4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
   - –ú–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω)
   - –ú–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã –±–µ–∑ –æ—à–∏–±–æ–∫
   - –ú–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –ø–æ–ª—è

---

## üöÄ –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å singleton –¥–ª—è RosreestrLKClient (`bot/services/rosreestr_lk/__init__.py`)
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `navigate_to_search_page()` –≤ `RosreestrLKClient`
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_parse_rights_data()` –≤ `worker.py`
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_enrich_data_from_lk()` –≤ `worker.py`
5. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤ –≤ `_process_results()` (–ø–æ—Å–ª–µ `_fetch_api_data`, –ø–µ—Ä–µ–¥ `_create_map_tasks_for_land_plots`)
6. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –≤ `bot/services/__init__.py`
7. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫—Ä—ã—Ç–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤ `run.py` (–≤ –±–ª–æ–∫–µ `finally`)
8. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ

---

## üìä –î–µ—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –º–µ—Ç–æ–¥–∞ `_enrich_data_from_lk`

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:

1. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤:**
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã –±–µ–∑ –æ—à–∏–±–æ–∫ (`not obj.has_error()`)
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `owner` –∏–ª–∏ `encumbrances` –ø—É—Å—Ç—ã–µ
   - –≠—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å - –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

2. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞:**
   - –ü–æ–ª—É—á–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —á–µ—Ä–µ–∑ `get_lk_client()`
   - –ï—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω - –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ñ–æ—Ä–º–µ
   - –ë—Ä–∞—É–∑–µ—Ä –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –∑–∞–¥–∞—á–µ

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞:**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∫–∞–ø—á–∏ (LLM –∏–ª–∏ Tesseract)
   - –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π (–∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä –∏ –∫–∞–ø—á–∞)
   - –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –ø–æ–∏—Å–∫–∞
   - –û–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - –ö–ª–∏–∫ –ø–æ –ø–µ—Ä–≤–æ–π —Å—Å—ã–ª–∫–µ
   - –û–∂–∏–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –æ–±—ä–µ–∫—Ç–∞
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–∞–≤–∞—Ö –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö
   - –ü–∞—Ä—Å–∏–Ω–≥ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π `owner` –∏ `encumbrances`
   - –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –ö–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
   - –û—à–∏–±–∫–∞ –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ - –ª–æ–≥–∏—Ä—É–µ–º –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –æ–±—ä–µ–∫—Ç—É
   - –ü—ã—Ç–∞–µ–º—Å—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ

5. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ:**
   - –ë—Ä–∞—É–∑–µ—Ä –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏
   - –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - –ï—Å–ª–∏ –±—ã–ª–∏ –æ—à–∏–±–∫–∏ - –æ–±—ä–µ–∫—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è —Å –∏—Å—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ API

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

- **–í—Ä–µ–º—è –Ω–∞ –æ–±—ä–µ–∫—Ç:** ~10-15 —Å–µ–∫—É–Ω–¥ (–∫–∞–ø—á–∞ + –ø–æ–∏—Å–∫ + –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ)
- **–î–ª—è 10 –æ–±—ä–µ–∫—Ç–æ–≤:** ~2-3 –º–∏–Ω—É—Ç—ã
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã —Å –ø—É—Å—Ç—ã–º–∏ –ø–æ–ª—è–º–∏

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:

- **Fallback:** –ï—Å–ª–∏ –õ–ö –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ API –¥–∞–Ω–Ω—ã–µ
- **–ß–∞—Å—Ç–∏—á–Ω–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:** –ï—Å–ª–∏ –¥–ª—è —á–∞—Å—Ç–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ - –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–æ–ø–æ–ª–Ω—è—é—Ç—Å—è
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
